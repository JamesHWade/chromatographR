<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Function returns a peak_table object. The first slot contains a matrix of
intensities, where rows correspond to samples and columns correspond to
aligned features. The rest of the slots contain various meta-data about peaks,
samples, and experimental settings."><title>Convert peak list into an ordered peak table — get_peaktable • chromatographR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert peak list into an ordered peak table — get_peaktable"><meta property="og:description" content="Function returns a peak_table object. The first slot contains a matrix of
intensities, where rows correspond to samples and columns correspond to
aligned features. The rest of the slots contain various meta-data about peaks,
samples, and experimental settings."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">chromatographR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/chromatographR.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ethanbass/chromatographR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Convert peak list into an ordered peak table</h1>
      <small class="dont-index">Source: <a href="https://github.com/ethanbass/chromatographR/blob/HEAD/R/get_peaktable.R" class="external-link"><code>R/get_peaktable.R</code></a></small>
      <div class="d-none name"><code>get_peaktable.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Function returns a peak_table object. The first slot contains a matrix of
intensities, where rows correspond to samples and columns correspond to
aligned features. The rest of the slots contain various meta-data about peaks,
samples, and experimental settings.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">get_peaktable</span><span class="op">(</span>
  <span class="va">peak_list</span>,
  chrom_list <span class="op">=</span> <span class="cn">NULL</span>,
  response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"area"</span>, <span class="st">"height"</span><span class="op">)</span>,
  use.cor <span class="op">=</span> <span class="cn">FALSE</span>,
  hmax <span class="op">=</span> <span class="fl">0.2</span>,
  plot_it <span class="op">=</span> <span class="cn">FALSE</span>,
  ask <span class="op">=</span> <span class="va">plot_it</span>,
  clust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rt"</span>, <span class="st">"sp.rt"</span><span class="op">)</span>,
  sigma.t <span class="op">=</span> <span class="cn">NULL</span>,
  sigma.r <span class="op">=</span> <span class="fl">0.5</span>,
  deepSplit <span class="op">=</span> <span class="cn">FALSE</span>,
  out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"data.frame"</span>, <span class="st">"matrix"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>peak_list</dt>
<dd><p>A nested list of peak tables: the first level is the
sample, and the second level is the component. Every component is described
by a matrix where every row is one peak, and the columns contain information
on retention time, full width at half maximum (FWHM), peak width, height,
and area.</p></dd>
<dt>chrom_list</dt>
<dd><p>A list of chromatographic matrices.</p></dd>
<dt>response</dt>
<dd><p>An indicator whether peak area or peak height is to be used
as intensity measure. Default is peak area.</p></dd>
<dt>use.cor</dt>
<dd><p>Logical, indicating whether to use corrected retention times
(by default) or raw retention times (not advised!).</p></dd>
<dt>hmax</dt>
<dd><p>Height at which the complete linkage dendrogram will be cut. Can
be interpreted as the maximal inter-cluster retention time difference.</p></dd>
<dt>plot_it</dt>
<dd><p>Logical. If TRUE, for every component a stripplot will be
shown indicating the clustering.</p></dd>
<dt>ask</dt>
<dd><p>Logical. Ask before showing new plot?</p></dd>
<dt>clust</dt>
<dd><p>Specify whether to perform hierarchical clustering based on
spectral similarity and retention time ("sp.rt") or retention time alone
("rt"). Defaults to "rt". The "sp.rt" option is experimental and should be 
used with some caution.</p></dd>
<dt>sigma.t</dt>
<dd><p>Width of gaussian in retention time distance function.
Controls weight of retention time.</p></dd>
<dt>sigma.r</dt>
<dd><p>Width of gaussian in spectral similarity function. Controls
weight of spectral correlation.</p></dd>
<dt>deepSplit</dt>
<dd><p>Logical. Controls sensitivity to cluster splitting. If
TRUE, will return more smaller clusters. See documentation for
<code>cutreeDynamic</code>.</p></dd>
<dt>out</dt>
<dd><p>Specify "data.frame" or "matrix" as output. Defaults to
`data.frame`.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns a peak_table object, consisting of the following
elements:
`tab`: the peak table itself -- a data-frame of intensities in a
sample x peak configuration.
peaks (columns).
`pk_meta`: A data.frame containing peak meta-data (e.g. the spectral component,
peak number, and average retention time).
`sample_meta`: A data.frame of sample meta-data. Must be added using
<code><a href="attach_metadata.html">attach_metadata</a></code>)
`ref_spectra`: A data.frame of reference spectra (in a wavelength x peak
configuration). Must be added using <code><a href="attach_ref_spectra.html">attach_ref_spectra</a></code>`args`: A vector of arguments given to <code>get_peaktable</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs a complete linkage clustering of retention times across
all samples, and cuts at a height given by the user (which can be understood
as the maximal inter-cluster retention time difference) in the simple case
based on retention times. Clustering can also incorporate information about
spectral similarity using a distance function adapted from Broeckling et al.,
2014: $$\exp({-\frac{(1-c_{ij})^2}{2\sigma_r^2}})*\exp({-\frac{(1-(t_i -
t_j)^2}{2\sigma_t^2}})$$.</p>
<p>If two peaks from the same sample are assigned to the same cluster, a warning
message is printed to the console. These warnings can usually be ignored, but
one could also consider reducing the <code>hmax</code> variable. However, this may 
lead to splitting of peaks across multiple clusters. Another option is to
filter the peaks by intensity to remove small features.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Adapted from
<a href="https://github.com/rwehrens/alsace/blob/master/R/getPeakTable.R" class="external-link">https://github.com/rwehrens/alsace/blob/master/R/getPeakTable.R</a>getPeakTable
function in the alsace package by Ron Wehrens.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Broeckling, C. D., F. A. Afsar, S. Neumann, A. Ben-Hur, and J.
E. Prenni. 2014. RAMClust: A Novel Feature Clustering Method Enables
Spectral-Matching-Based Annotation for Metabolomics Data. <em>Anal. Chem.</em>
<b>86</b>:6812-6817.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="attach_ref_spectra.html">attach_ref_spectra</a></code> <code><a href="attach_metadata.html">attach_metadata</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Ethan Bass</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Sa_pr</span><span class="op">)</span></span>
<span class="r-in"><span class="va">pks</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_peaks.html">get_peaks</a></span><span class="op">(</span><span class="va">Sa_pr</span>, lambdas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'210'</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">get_peaktable</span><span class="op">(</span><span class="va">pks</span>, response <span class="op">=</span> <span class="st">"area"</span><span class="op">)</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>More than one peak of one injection in the same cluster</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> for component 1.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Keeping only the most intense one.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           X1       X2       X3       X4        X5        X6         X7       X8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 119 260.9597  0.00000 30.92981 94.03383  769.4859  19.92870 4051.40350    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 121 204.0379  0.00000 45.97627 23.82418    0.0000 389.30453    0.00000    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 122 410.5215 48.67966 29.39020 98.19779 1294.4447  91.97236    0.00000 2981.014</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 458 295.2217  0.00000 94.02964  0.00000  243.9648 741.83980   18.46819    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             X9        X10        X11       X12       X13       X14       X15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 119  133.00682 2107.71843   78.53709  68.14431 116.36674 1848.3052  759.3063</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 121 2863.55673   44.47693  912.78961   0.00000  42.84824  375.1831    0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 122   55.55018   70.87332 1791.92740  61.76002 211.86240    0.0000 1580.3078</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 458 5519.70162  207.40679 1673.15656 168.58992  68.12473  280.8577    0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           X16      X17        X18       X19       X20       X21       X22</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 119    0.0000 1695.406    0.00000 208.38958  69.35061 198.25494 96.610047</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 121 1016.7917    0.000 1111.87828   0.00000  56.18324  86.16721  5.486941</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 122  645.5042 1420.343   65.72994 111.60827   0.00000 151.87067 24.277725</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 458 2121.5831    0.000 1242.67116  22.58176 244.87533 260.53421 13.762594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          X23      X24      X25      X26        X27       X28      X29       X30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 119 631.6451 739.0477   0.0000 121.2293  0.0000000 5.6158870 2.478254  884.5136</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 121   0.0000 332.7662 600.6048   0.0000 38.8425554 0.6490484 2.676501  698.5696</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 122 397.3674 130.5012 720.9317 139.0383  0.7108261 0.0000000 5.538164  830.4333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 458   0.0000 612.7060 741.7732 112.1529  0.0000000 0.0000000 1.658587 1179.0521</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          X31      X32      X33      X34      X35      X36       X37</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 119 98.06441 39.18598 45.47252 84.52052 51.17507 77.06908 114.02089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 121 28.76913 27.29513 26.30663 22.16925 54.14121  0.00000  85.32191</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 122 48.49794 60.99947 61.25551 43.17413 64.44801  0.00000 205.86090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 458 54.02170 49.80864 71.31631 78.53060 72.78320  0.00000 186.14514</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ethan Bass.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

